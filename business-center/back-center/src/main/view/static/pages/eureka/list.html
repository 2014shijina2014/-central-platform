<div class="layui-card">
    <div class="layui-card-header">
        <h2 class="header-title">服务治理</h2>
        <span class="layui-breadcrumb pull-right">
          <a href="#!console">首页</a>
          <a><cite>服务治理</cite></a>
        </span>
    </div>
    <div class="layui-card-body">

        <table class="layui-table" id="eureka-table" lay-filter="eureka-table"></table>

    </div>
</div>

<!-- 表格状态列 -->
<script type="text/html" id="eureka-tpl-state">
    <input type="checkbox" lay-filter="eureka-tpl-state" value="{{d.instanceId}}" lay-skin="switch" lay-text="正常|锁定"
           {{d.status=='UP'?'checked':''}}/>
</script>


<script>
    layui.use(['form', 'table', 'util', 'config', 'admin'], function () {
        var form = layui.form;
        var table = layui.table;
        var config = layui.config;
        var layer = layui.layer;
        var util = layui.util;
        var admin = layui.admin;


        var renderTable = function () {
            admin.req('api-eureka/eureka/apps', {}, function (data) {
                var applications = new Array();
                for (var i = 0; i <  data.applications.application.length; i++) {
                    var instances = data.applications.application[i].instance;
                    for (var j = 0; j < instances.length; j++ ){
                        var instance = instances[j];
                        applications.push(instance);
                    }
                }
                console.log(applications);

                // // 渲染表格
                table.render({
                    elem: '#eureka-table',
                    data: applications,
                    page: false,
                    cols: [[
                        {type: 'numbers'},
                        {field: 'app', sort: true, title: '服务名称'},
                        {field: 'ipAddr', sort: true, title: 'IP地址'},
                        {field: 'homePageUrl', sort: true, title: '页面地址'},
                        {field: 'status', sort: true, title: '状态'},
                        {field: 'enabled', sort: true, templet: '#eureka-tpl-state', title: '状态'}
                    ]]
                });
                console.log(data);
            }, 'GET');
        };

        renderTable();

        // 修改状态
        form.on('switch(eureka-tpl-state)', function (obj) {
            layer.load(2);
            console.log(obj.elem.value)
            console.log(obj.elem.checked ? 'UP' : 'DOWN')

            // admin.req('api-user/users/updateEnabled', {
            //     id: obj.elem.value,
            //     enabled: obj.elem.checked ? 'UP' : 'DOWN'
            // }, function (data) {
            //
            // }, 'GET');
        });



    });
</script>